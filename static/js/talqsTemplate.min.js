/**
 * TalqsTemplate v1.0.0
 * (c) 2018 JinJun He
 * @license MIT
 */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.TalqsTemplate=n()}(this,function(){"use strict";function e(e){return e.replace($,"").replace(w,",").replace(b,"").replace(I,"").replace(q,"").split(x)}function n(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function a(a,t){function i(e){return f+=e.split(/\n/).length-1,u&&(e=e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),e&&(e=g[1]+n(e)+g[2]+"\n"),e}function l(n){var a=f;if(c?n=c(n,t):r&&(n=n.replace(/\n/g,function(){return"$line="+ ++f+";"})),0===n.indexOf("=")){var i=d&&!/^=[=#]/.test(n);if(n=n.replace(/^=[=#]?|[\s;]*$/g,""),i){var l=n.replace(/\s*\([^\)]+\)/,"");p[l]||/^(include|print)$/.test(l)||(n="$escape("+n+")")}else n="$string("+n+")";n=g[1]+n+g[2]}return r&&(n="$line="+a+";"+n),y(e(n),function(e){if(e&&!m[e]){var n;n="print"===e?w:"include"===e?b:p[e]?"$utils."+e:v[e]?"$helpers."+e:"$data."+e,I+=e+"="+n+",",m[e]=!0}}),n+"\n"}var r=t.debug,s=t.openTag,o=t.closeTag,c=t.parser,u=t.compress,d=t.escape,f=1,m={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},h="".trim,g=h?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],$=h?"$out+=text;return $out;":"$out.push(text);",w="function(){var text=''.concat.apply('',arguments);"+$+"}",b="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+$+"}",I="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(r?"$line=0,":""),q=g[0],x="return new String("+g[3]+");";y(a.split(s),function(e){e=e.split(o);var n=e[0],a=e[1];1===e.length?q+=i(n):(q+=l(n),a&&(q+=i(a)))});var z=I+q+x;r&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+n(a)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var _=new Function("$data","$filename",z);return _.prototype=p,_}catch(e){throw e.temp="function anonymous($data,$filename) {"+z+"}",e}}var t=function(e,n){return"string"==typeof n?h(n,{filename:e}):r(e,n)};t.version="3.0.0",t.config=function(e,n){i[e]=n};var i=t.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},l=t.cache={};t.render=function(e,n){return h(e)(n)};var r=t.renderFile=function(e,n){var a=t.get(e)||m({filename:e,name:"Render Error",message:"Template not found"});return n?a(n):a};t.get=function(e){var n;if(l[e])n=l[e];else if("object"==typeof document){var a=document.getElementById(e);if(a){var t=(a.value||a.innerHTML).replace(/^\s*|\s*$/g,"");n=h(t,{filename:e})}}return n};var s=function(e,n){return"string"!=typeof e&&(n=typeof e,"number"===n?e+="":e="function"===n?s(e.call(e)):""),e},o={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},c=function(e){return o[e]},u=function(e){return s(e).replace(/&(?![\w#]+;)|[<>"']/g,c)},d=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},f=function(e,n){var a,t;if(d(e))for(a=0,t=e.length;a<t;a++)n.call(e,e[a],a,e);else for(a in e)n.call(e,e[a],a)},p=t.utils={$helpers:{},$include:r,$string:s,$escape:u,$each:f};t.helper=function(e,n){v[e]=n};var v=t.helpers=p.$helpers;t.onerror=function(e){var n="Template Error\n\n";for(var a in e)n+="<"+a+">\n"+e[a]+"\n\n";"object"==typeof console&&console.error(n)};var m=function(e){return t.onerror(e),function(){return"{Template Error}"}},h=t.compile=function(e,n){function t(a){try{return new o(a,s)+""}catch(t){return n.debug?m(t)():(n.debug=!0,h(e,n)(a))}}n=n||{};for(var r in i)void 0===n[r]&&(n[r]=i[r]);var s=n.filename;try{var o=a(e,n)}catch(e){return e.filename=s||"anonymous",e.name="Syntax Error",m(e)}return t.prototype=o.prototype,t.toString=function(){return o.toString()},s&&n.cache&&(l[s]=t),t},y=p.$each,g="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",$=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,w=/[^\w$]+/g,b=new RegExp(["\\b"+g.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),I=/^\d[^,]*|,\d[^,]*/g,q=/^,+|,+$/g,x=/^$|,+/;i.openTag="{{",i.closeTag="}}";var z=function(e,n){var a=n.split(":"),t=a.shift(),i=a.join(":")||"";return i&&(i=", "+i),"$helpers."+t+"("+e+i+")"};i.parser=function(e,n){e=e.replace(/^\s/,"");var a=e.split(" "),i=a.shift(),l=a.join(" ");switch(i){case"if":e="if("+l+"){";break;case"else":a="if"===a.shift()?" if("+a.join(" ")+")":"",e="}else"+a+"{";break;case"/if":e="}";break;case"each":var r=a[0]||"$data",s=a[1]||"as",o=a[2]||"$value",c=a[3]||"$index",u=o+","+c;"as"!==s&&(r="[]"),e="$each("+r+",function("+u+"){";break;case"/each":e="});";break;case"echo":e="print("+l+");";break;case"print":case"include":e=i+"("+a.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(l)){var d=!0;0===e.indexOf("#")&&(e=e.substr(1),d=!1);for(var f=0,p=e.split("|"),v=p.length,m=p[f++];f<v;f++)m=z(m,p[f]);e=(d?"=":"=#")+m}else e=t.helpers[i]?"=#"+i+"("+a.join(",")+");":"="+e}return e};var _={Question:"question",StemsWrapper:"stemsWrapper",ChildQSAnalyze:"childQSAnalyzeWrapper",AnalyzeWrapper:"analyzeWrapper",Index:"questionIndex",Source:"questionSource",Difficulty:"questionDifficulty",Content:"questionContent",Options:"questionOptions",ChildList:"questionChildList",Answer:"questionAnswer",AnswerItem:"questionAnswerItem",Analyze:"questionAnalyze",AnalyzeItem:"questionAnalyzeItem",KnowledgePoint:"questionKnowledgePoint",KnowledgePointItem:"questionKnowledgePointItem",QueID:"questionID"},A={};A[_.Question]=[_.StemsWrapper,_.AnalyzeWrapper],A[_.StemsWrapper]=[_.Index,_.Source,_.Difficulty,_.Content,_.Options,_.ChildList,_.ChildQSAnalyze],A[_.AnalyzeWrapper]=[_.Answer,_.Analyze,_.KnowledgePoint,_.QueID],A[_.ChildQSAnalyze]=[_.Answer,_.Analyze,_.KnowledgePoint,_.QueID];var S={answer:"答案",analyze:"解析",queId:"ID",knowledgePoint:"知识点",label:"标签"},C="talqs",L="talqs_options",j={main:C,options:L,stems:"talqs_main",subqs:"talqs_subqs",content:"talqs_content",difficulty:"talqs_difficulty",index:"talqs_index",source:"talqs_source",knowledgePoint:"talqs_knowledge_point",id:"talqs_id",analyzeItem:"talqs_analyze_item",analyzeItemIndex:"talqs_analyze_item_index",panelItem:"talqs_panel_item",panelItemContent:"talqs_panel_item_content",panelItemIndex:"talqs_panel_item_index",answer:"talqs_answer",analyze:"talqs_analyze",analyzeGroup:"talqs_analyze_group",analyzeLayer:"talqs_analyze_layer",analyzeSingle:"talqs_analyze_single",optionsList:L+"_list",optionsRows:L+"_rows",optionsColumns:L+"_columns",optionsItem:L+"_columns_item",optionsIndex:L+"_index",optionsLabel:L+"_label",optionsContent:L+"_content",layoutComplete:"talqs_layout_complete",label:"talqs_label",panel:"talqs_panel",tree:"talqs_tree",clear:"clearfix"},k={analyzeVersion:0,hideSource:!1,hideDifficulty:!1,templates:A,labels:S,queIndex:0,entryTemplate:_.Question,autoLayoutHook:'[data-auto-layout="1"]',layoutClassName:j.optionsList,layoutCompleteClassName:j.layoutComplete,components:_,showMultiAnswer:!0,separator:{0:[" ; "," 或 "]}},O={};O.json=function(e){return JSON.stringify(e)},O.formatDifficulty=function(e,n){e=parseInt(e,10)||0;for(var a="",t=0;t<e;t++)a+=n;return a},O.formatAnswer=function(e,n){var a="";if(Array.isArray(e)){var t=e.length,i=parseInt(n.type,10)||0,l=parseInt(n.subjectId,10)||0,r=n.separator[l],s=n.showMulti,o=r[0],c=r[1];switch(i){case 4:e.forEach(function(e,n){Array.isArray(e)?a+=e.length>1&&s?e.join(c):e[0]:a+=e,n<t-1&&(a+=o)});break;case 10:for(var u=0;u<t;u++)u%5==0&&u>0&&(a+=" "),a+=e[u];break;default:a=e.join("")}}return a};var W,Q='<div class="'+j.main+'" data-talqs-root="{{data.queId}}">\n  {{ each config.templates[\''+_.Question+"'] }}\n    {{include $value}}\n  {{/each}}\n</div>\n",T='\n<div class="'+j.stems+" "+j.clear+'" data-que-id="{{data.queId}}">\n {{each config.templates[\''+_.StemsWrapper+"']}}\n    {{include $value}}\n {{/each}}\n</div>\n",D='\n  {{if config.analyzeVersion === 2}}\n     <div class="'+j.analyzeGroup+'">\n      <div class="'+j.analyzeLayer+"\">\n        {{ each config.templates['"+_.AnalyzeWrapper+"'] }}\n          {{include $value}}\n        {{/each}}\n      </div>\n    </div>\n  {{/if}}\n",P='\n{{if index && index > 0}}\n  <span class="'+j.index+'">{{index}}</span>\n{{/if}}\n',E='\n{{if !isSub && !config.hideSource}}\n  <div class="'+j.source+'">\n    {{data.queSource}}\n  </div>\n{{/if}}\n',N='\n{{if data.content && !data.hideContent}}\n  <div class="'+j.content+" "+j.clear+'">\n    {{if data.queDesc}}\n      <div>{{data.queDesc}}</div>\n    {{/if}}\n    {{#data.content}}\n  </div>\n{{/if}}\n',K='\n{{ if data.answerOptionList && data.answerOptionList.length }}\n  <div class="'+j.options+" "+j.clear+'">\n    <ul class="'+j.optionsList+'" data-auto-layout="{{data.answerOptionList[0].length}}">\n      {{each data.answerOptionList}}\n        <li class="'+j.optionsRows+" "+j.clear+'">\n          {{if data.isCloze}}\n            <span class="'+j.optionsIndex+'">{{$index+1}}. </span>\n          {{/if}}\n          <ul class="'+j.optionsColumns+"_{{$value.length}} "+j.clear+'">\n            {{each $value}}\n              <li class="'+j.optionsItem+" "+j.clear+'">\n                <span class="'+j.optionsLabel+'">{{$value.aoVal}}. </span>\n                <div class="'+j.optionsContent+'">{{#$value.content}}</div>\n              </li>\n            {{/each}}\n          </ul>\n        </li>\n      {{/each}}\n    </ul>\n  </div>\n{{/if}}\n',M='\n{{if !isSub && !config.hideDifficulty}}\n  <div class="'+j.difficulty+"\">\n    {{#data.difficulty | formatDifficulty:'<span>&#9733;</span>'}}\n  </div>\n{{/if}}\n",R='\n{{ if data.childList }}\n  <div class="'+j.subqs+"\">\n    {{each data.childList}}\n      {{include '"+_.StemsWrapper+"' {data:$value,config:config,index:$index+1,isSub:true} ''}}\n    {{/each}}\n  </div>\n{{/if}}\n",H='\n{{if isSub && config.analyzeVersion === 1 && !data.childList }}\n   <div class="'+j.analyzeSingle+"\">\n    {{ each config.templates['"+_.ChildQSAnalyze+"'] }}\n      {{include $value}}\n    {{/each}}\n  </div>\n{{/if}}\n",V='\n<div class="'+j.answer+"  "+j.clear+'">\n  <label class="'+j.label+'">\n    {{config.labels.answer}}\n  </label>\n  <div class="'+j.panel+"\">\n    {{include '"+_.AnswerItem+"'}}\n  </div>\n</div>\n",F='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+j.analyzeItem+'">\n      <div class="'+j.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+_.AnswerItem+"' {data:$value,config:config} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+j.panelItem+'">\n    <div class="'+j.panelItemContent+'">\n        {{#data.answer | formatAnswer:{type:data.logicQuesTypeId,subject:data.subjectId,separator:config.separator,showMulti:config.showMultiAnswer} }}\n    </div>\n  </div>\n{{/if}}\n',G='\n<div class="'+j.analyze+"  "+j.clear+'">\n  <label class="'+j.label+'">\n    {{config.labels.analyze}}\n  </label>\n  <div class="'+j.panel+"\">\n    {{include '"+_.AnalyzeItem+"'}}\n  </div>\n</div>\n",B='\n{{if data.childList}}\n  {{each data.childList}}\n    <div class="'+j.analyzeItem+'">\n      <div class="'+j.analyzeItemIndex+"\">{{$index+1}}</div>\n      {{include '"+_.AnalyzeItem+"' {data:$value} ''}}\n    </div>\n  {{/each}}\n{{else}}\n  <div class=\""+j.panelItem+'">\n    {{each data.analysis }}\n      {{if data.analysis.length > 1}}\n        <span class="'+j.panelItemIndex+'">{{$index+1}}.</span>\n      {{/if}}\n      <div class="'+j.panelItemContent+'">\n        {{#$value}}\n      </div>\n    {{/each}}\n  </div>\n{{/if}}\n',J='\n <div class="'+j.knowledgePoint+"  "+j.clear+'">\n  <label class="'+j.label+'">\n    {{config.labels.knowledgePoint}}\n  </label>\n  <div class="'+j.tree+"\">\n    <ul>\n      {{each data.examOptionList}}\n        {{include '"+_.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  </div>\n</div>\n",U="\n<li>\n  {{data.name}}\n  {{if data.childList}}\n    <ul>\n      {{each data.childList}}\n        {{include '"+_.KnowledgePointItem+"' {data:$value} ''}}\n      {{/each}}\n    </ul>\n  {{/if}}\n</li>\n",X='\n<div class="'+j.id+"  "+j.clear+'">\n  <label class="'+j.label+'">\n    {{config.labels.queId}}\n  </label>\n  <div class="'+j.panel+'">\n    {{data.queId}}  \n  </div>\n</div>\n',Y=(W={},W[_.Question]=Q,W[_.StemsWrapper]=T,W[_.AnalyzeWrapper]=D,W[_.ChildQSAnalyze]=H,W[_.Index]=P,W[_.Source]=E,W[_.Content]=N,W[_.Options]=K,W[_.Difficulty]=M,W[_.ChildList]=R,W[_.Answer]=V,W[_.AnswerItem]=F,W[_.Analyze]=G,W[_.AnalyzeItem]=B,W[_.KnowledgePoint]=J,W[_.KnowledgePointItem]=U,W[_.QueID]=X,W),Z=function(e){throw new Error(e)},ee={InvalidQS:"Expect an object"},ne={version:"1.0.0",config:k,get components(){return this.config.components}},ae=Object.assign||function(e,n){var a=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var l=a[i];if(null!=l)for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r])}return t},te=function(e){return e&&"object"==typeof e};ne.render=function(e,n){if(!e||!te(e))return Z(ee.InvalidQS);n=n||{};for(var a in k){var i=k[a];if(void 0===n[a])n[a]=i;else{var l=n[a];te(l)&&(n[a]=ae({},i,l))}}return ne.config=n,(0,t.cache[n.entryTemplate])({config:n,data:e,index:n.queIndex})},ne.renderPartialComponent=function(e,n){if(!n||!te(n))return Z(ee.InvalidQS);var a=ne.config,i=t.cache[e];return i&&i({config:a,data:n})};var ie=function(e,n){t.helper(e,n)};ne.registerHelper=ie;for(var le in O)ie(le,O[le]);var re=function(e){for(var n in e){var a=e[n].replace(/^\s*|\s*$/g,""),i=t.compile(a,{filename:n});t.cache[n]=i}};re(Y);var se=function(e){var n=ne.config.templates;for(var a in e)!function(a){var t=e[a],i=n[a]||[];t.exclude&&t.exclude.length&&i.length&&(i=i.filter(function(e){return-1===t.exclude.indexOf(e)}));var l={};if(t.template&&(l[a]=t.template),t.components&&t.components.length){var r=void 0,s=void 0;t.components.forEach(function(e){if(r=e.name,(s=i.indexOf(r))<0){var n=isNaN(e.index)?i.length:e.index;i.splice(n,0,r)}else isNaN(e.index)||(i.splice(s,1),i.splice(e.index,0,r));l[r]=e.template})}Object.keys(l).length&&re(l),ne.config.templates[a]=i.filter(function(e){return"string"==typeof e})}(a)};return ne.updateTemplateList=se,ne.autoLayout=function(e){var n=ne.config.autoLayoutHook,a=document.querySelectorAll(n);if(a&&a.length){var t=ne.config.layoutCompleteClassName;a=Array.prototype.slice.apply(a),a.forEach(function(n){var a=e||Math.floor(n.offsetWidth);n.style.display="inline-block";var i=n.children.length,l=Math.ceil(n.offsetWidth+10),r=1;if(l){r=i<=Math.floor(a/l)?i:l>=a/2?1:l>=a/4?2:4}var s=ne.config.layoutClassName+"_",o=new RegExp(s+"\\d","g");n.className=n.className.replace(o,""),n.classList.add(s+r),n.classList.add(t),n.style.display=""})}},ne.resetComponent=function(){var e=Array.prototype.slice.call(arguments),n={};e.length?e.forEach(function(e){var a=Y[e];a&&(n[e]=a)}):n=Y,re(n)},ne});
